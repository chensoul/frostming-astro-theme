---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { themeConfig } from '../theme/config';

const posts: CollectionEntry<'posts'>[] = (await getCollection('posts'))
  .filter((p: CollectionEntry<'posts'>) => !p.data.draft)
  .sort((a: CollectionEntry<'posts'>, b: CollectionEntry<'posts'>) => +b.data.pubDate - +a.data.pubDate)
  .slice(0, 8);
---
<BaseLayout canonical={themeConfig.siteUrl}>
  <Header />
  <hr class="border-current" />
  <main class="py-8">
    <ul class="divide-y divide-gray-200 dark:divide-gray-800">
      {posts.map(({ data, slug }) => (
        <li class="py-3 first:pt-0">
          <article class="grid grid-cols-1 gap-3 sm:grid-cols-[120px_1fr] sm:gap-6 sm:items-baseline">
            <time datetime={data.pubDate.toISOString()} class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 font-mono whitespace-nowrap">
              {`${data.pubDate.getFullYear()}–${String(data.pubDate.getMonth() + 1).padStart(2, '0')}–${String(data.pubDate.getDate()).padStart(2, '0')}`}
            </time>
            <div class="flex flex-wrap items-center gap-2">
              <a href={`/posts/${String(data.pubDate.getFullYear())}/${String(data.pubDate.getMonth() + 1).padStart(2, '0')}/${String(data.pubDate.getDate()).padStart(2, '0')}/${slug}/`} class="post-title text-lg font-bold leading-6 hover:opacity-70 transition-opacity">{data.title}</a>
              {data.tags?.map((t: string) => (
                <a href={`/tags/${encodeURIComponent(t)}/`} class="inline-block rounded-full bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 px-3 py-1 text-xs">
                  {t}
                </a>
              ))}
            </div>
          </article>
        </li>
      ))}
    </ul>
    <div class="mt-8 text-right">
      <a href="/archive" class="text-gray-500 hover:text-black dark:text-gray-400 dark:hover:text-white transition-colors">
        查看全部 →
      </a>
    </div>
  </main>
</BaseLayout>
